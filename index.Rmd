---
title: "HCERES ERPI"
description: |
  Production de connaissances et activités concourant au rayonnement et à l’attractivité scientifique.
author:
    
  - first_name: "Laboratoire"
    last_name: "ERPI"
    url: https://erpi.univ-lorraine.fr/
    affiliation: ERPI
    affiliation_url: https://erpi.univ-lorraine.fr/
    #orcid_id: 0000-0003-3867-2438 
  # - first_name: "Fréderique"
  #   last_name: "Mayer"
  #   url: https://erpi.univ-lorraine.fr/people/Frederique-Mayer/
  #   affiliation: ERPI
  #   affiliation_url: https://erpi.univ-lorraine.fr/
  #   orcid_id: 
  # - first_name: "Eric"
  #   last_name: "Bonjour"
  #   url: https://erpi.univ-lorraine.fr/people/Eric-Bonjour/
  #   affiliation: ERPI
  #   affiliation_url: https://erpi.univ-lorraine.fr/
  #   orcid_id: 0000-0001-7851-1095 
  # - first_name: "Manon"
  #   last_name: "Enjolras"
  #   url: https://erpi.univ-lorraine.fr/people/Manon-Enjolras/
  #   affiliation: ERPI
  #   affiliation_url: https://erpi.univ-lorraine.fr/
  #   orcid_id: 0000-0003-4570-1989
  #       
  # - first_name: "Fabio"
  #   last_name: "Cruz"
  #   url: https://erpi.univ-lorraine.fr/people/Fabio-Cruz/
  #   affiliation: ERPI
  #   affiliation_url: https://erpi.univ-lorraine.fr/
  #   orcid_id: 0000-0001-8529-5327
date: "`r Sys.Date()`"
#output: distill::distill_article
site: distill::distill_website
editor_options: 
  chunk_output_type: console
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE)
library(tidyverse)
library(knitr)
library(kableExtra)
#library(DT)
library(rmarkdown)
library(reactable)
library(here)
library(jsonlite)
library(tidyverse)
library(plotly)
library(reshape2)


theme_fabio <- function(base_size = 12, base_family = "Palatino"){
  theme_minimal(base_size = base_size, base_family = base_family) %+replace%
    theme(
      #line = element_line(colour="black"),
      #text = element_text(colour="black"),
      #axis.title = element_text(size = 14),
      #axis.text = element_text(colour="black", size=8),
      #strip.text = element_text(size=12),
      #legend.key=element_rect(colour=NA, fill =NA),
      #panel.grid = element_blank(),   
      #panel.border = element_rect(fill = NA, colour = "black", size=1),
      #panel.background = element_rect(fill = "white", colour = "black"), 
      #strip.background = element_rect(fill = NA),
      #plot.title = element_text(family = "Palatino", color="#666666", face="bold", size=20, hjust=0)
      )
}

```


# Critères d'evaluation

```{r table-evaluation, layout="l-body-outset"}
source("R/Overview-ERPI.R")
Overview
```


---

# Workshop ERPI 2019

## Competences ERPI par rapport aux reference ministère

```{r, cache=TRUE}
source("R/Workshop-ERPI.R")
```

Dans le tableau suivant montre les niveau evalué:

```{r}
Criteria <- tibble(
 Niveau = c(1:6) ,
Type = c( " ", "Novice", "Débutant avancé", "Compétent", "Performant",	"Expert"),
Description = c(
   "Ne comprend pas quelle est la compétence",
   "Comprendre ce qu’est la compétence et pourquoi elle est importante.",
   "Cette compétence est démontrée sous supervision ou avec encouragement.",
   "Cette compétence est démontrée indépendamment de la supervision ou de l’encouragement.",
   "Encourager ou superviser les autres dans cette compétence.",
   "Développer de nouvelles façons d’appliquer cette compétence. C’est mesuré sur la scène International")
)
```


```{r, layout="l-page", fig.width=10, fig.height=10, cache=TRUE}
source(here("Workshop/Workshop_2019.R"))
Workshop()
```




# Document froms HAL 2016 - 2020

Liste de production scientific:  Last update from HAL  "`r format(Sys.time(), '%d %B, %Y')`"


```{r HAL, include=FALSE}
# ERPI PUblications
source(here("R/Hal-data.R"))

#names(ERPI)
ERPI <- 
   ERPI %>% 
   select(Year, Type.document , Title, Authors, DOI, Journal, "Quartile-Scimago-Engineering", Scopus, Publisher, Conference ,  Url, H.Factor)
ERPI <- ERPI %>%arrange(desc(Year), Type.document)
#write_excel_csv2(ERPI, "HAL/ERPI-2016-2022.csv")

```




```{r Hal_raw, layout="l-screen-inset shaded"}

reactable(ERPI,
          defaultColDef = colDef(
            header = function(value) gsub(".", " ", value, fixed = TRUE),
            #cell = function(value) format(value, nsmall = 1),
            align = "center",
            minWidth = 25,
            headerStyle = list(background = "#f7f7f8")
          ),
          columns = list(
            Year = colDef(minWidth = 40),   
            Type.document = colDef(minWidth = 30),   
            Title = colDef(minWidth = 100),   
            Authors = colDef(minWidth = 100),   
            DOI = colDef(minWidth = 30),   
            Journal = colDef(minWidth = 30) ,
            `Quartile-Scimago-Engineering` = colDef(minWidth = 30),
            Scopus = colDef(minWidth = 40),   
            Conference = colDef(minWidth = 50),
            H.Factor = colDef(minWidth = 30),
            Url = colDef(minWidth = 40)  
          ),
          wrap = TRUE,
          filterable = TRUE, 
          bordered = TRUE, striped = TRUE, highlight = TRUE,
          compact = TRUE,
          showPageSizeOptions = TRUE, pageSizeOptions = c(1,2,5, 10, 50,100), defaultPageSize = 2
          #groupBy = "Year"
)
```


## Evolution of ERPI's Scientific production

Mise à jour: `r format(Sys.time(), '%d %B, %Y')`

```{r Production_total, layout="l-body-outset", fig.width=8, fig.height=4 }
source(here("R/Scientific-production.R"))
Production
```

## Journals

Principaux journaux de publication ERPI:

```{r Journals, layout="l-body-outset", fig.width=8, fig.height=4 }
source(here("R/journals.R"))
Journals
```

Impact Factor des journaux de publication ERPI:

```{r, layout="l-body-outset", fig.width=8, fig.height=6 }
source(here("R/IF.R"))
Impact.Factor
```

Profile des journaux qui sont en SCOPUS:

```{r Scopus-1}
Articles <- 
   ERPI %>% filter(Type.document == "ART") %>% arrange(desc(Year))

Articles %>% group_by(Year, Scopus) %>% tally(name = "Quantity") %>% 
  ggplot(aes(x=Year, y=Quantity, color = Scopus )) +
  geom_line() + geom_point() +
  labs(x="Années", y="Nombre des documents", title = "Articles listés dans la base SCOPUS", subtitle = "") +
  theme_fabio()
```

SCOPUS a une serie de Sous domaine lié à chaque journal. 
Dans ce wordcloud, une presentation des sous-domaines en tulisant les journaux references Scopus publiés par ERPI dans la periode 2016-2020

```{r, layout="l-body-outset", fig.width=8, fig.height=4}
source(here("R/Scopus-wordcloud.R"))
Scopus.wordcloud
```

Areas majors pour ERPI selon Scopus:

```{r}
kable(head(Domaines, 10))
```



### Scimago



```{r, layout="l-body-outset", fig.width=8, fig.height=4}
source(here("R/Scimago.R"))
Scimago
```




### Analyse CiteScore 

Scopus utilise cette mésure au lieu d'Impact factor utilisé par Thomson-Reuters: 

```{r Citescore}
#source(here("R/Citescore.R"))
```



# Tranches d'Ages

```{r, include=FALSE}
source("R/Age.R")
```

Membres (Prof, MDF, Admin et PostDoc/Chercheur contractuelle) présents à 2021 à l'ERPI:

- **Quantité total des perssones** : **`r nrow(Members)`**

Voila la liste des perssones à Dec 2021.

```{r}
paged_table(Members %>% select( Prenom, Nom)) %>% arrange(Prenom)
```


Pyramide des ages:

```{r}
library(lemon)

status <- Members %>% select(Prenom, Corps_grade, rango, Sexe) 

status %>% 
   ggplot( aes(x = rango, fill = Sexe)) + 
   geom_bar(data = subset(status, Sexe == "H")) + 
   geom_bar(data = subset(status, Sexe == "F"), 
            mapping = aes(y = - ..count.. ),
            position = "identity") +
   #scale_y_continuous(labels = abs) +
   scale_y_symmetric(labels = abs, n.breaks=10) +
   coord_flip()+
   
   labs(y="Nombre des personnes", 
        x="Intervalle",
        title = "Tranche d'ages à l'ERPI",
        subtitle = paste0("Effectif total du personnel: ", nrow(status)) 
        ) +
   theme_fabio() +
   scale_fill_brewer(palette = "Set2") 
```

Piramide de profiles:


```{r}
status <- Members %>% select(Prenom, Emploi, Corps_grade, rango, Sexe) 
status$value = 1
#status$Corps_grade %>% as.factor() %>% levels()

status %>% 
   ggplot(aes(y = ifelse(test = Sexe == "H", yes = value, no = -value), 
              x = rango,
              fill = Emploi)) +
   geom_bar(stat = "identity") +
   scale_y_symmetric(labels = abs, n.breaks=10) +
   coord_flip()+
   labs(y="Nombre des personnes", 
        x="Intervalle",
        title = "Tranche d'ages à l'ERPI",
        subtitle = paste0("Effectif total du personnel: ", nrow(status)) 
        ) +
   theme_fabio() +
   scale_fill_brewer(palette = "Set2") 
```




```{r, layout="l-body-outset", fig.width=6, fig.height=4, include=FALSE, eval=FALSE}

# Pyramide des ages sans les chercheur contractuelles / Postdocs
piramide <- Membres %>% filter(Type_emploi != "Ch_aut") %>% group_by(rango, Sexe) %>% tally()

ggplot(data = piramide, 
       mapping = aes(x = ifelse(test = Sexe == "H", yes = -n, no = n), 
                     y = rango, fill = Sexe)) +
  geom_col() +
  scale_x_symmetric(labels = abs, n.breaks=10) +
  #scale_x_continuous(breaks = c(-6,-4,-2,0, 2, 4, 6)) +
  
  labs(x="Nombre des personnes", y="Intervalle", subtitle = "Tranche d'ages à l'ERPI\n(Sans chercheurs contractuelles)", title = "") +
  theme_fabio() +
  scale_fill_brewer(palette = "Set2") 

```


# International Collaborations {#collaboration}

```{r, include=FALSE}
library(rworldmap)
library(maps)
library(RColorBrewer)
library(forcats)

HAL <- read_csv("HAL/HAL-June-2021.csv") %>% set_names("Url", "Title", "Authors", "Type.document", "DOI", "Year", "Journal", "Publisher", "Conference", "Labs", "Countries") 

Countries <- paste(HAL$Countries,collapse=",")  
Countries <- strsplit(Countries, ",")  
Countries <- tibble(Paises=Countries[[1]])
Countries$Paises <- Countries$Paises %>% toupper() 
Countries <- Countries %>% group_by(Paises) %>% tally(name = "freq")

Countries$count_group <- cut(Countries$freq, 
                       breaks = c(-Inf, 2, 4, Inf), 
                       labels = c("Exploratoire\n(<2)", "En construction\n(2-4)", "Recurrent\n(>4)" ))

world_map <- map_data(map = "world")
world_map$region <- iso.alpha(world_map$region)
str(world_map)


```


```{r, layout="l-body-outset", fig.width=8, fig.height=4, include=TRUE, echo=FALSE}
ggplot(Countries) +
  geom_map(aes(map_id = Paises, fill = fct_rev(count_group)), map = world_map) +
  geom_polygon(data = world_map, aes(x = long, y = lat, group = group), colour = 'black', fill = NA) +
  #expand_limits(x = world_map$long, y = world_map$lat) +
  scale_fill_manual(name = "Collaboration" , values = c("#b2df8a","#1f78b4", "#a6cee3") ) +
  theme_void() +
  coord_fixed() 


```

On Europe

```{r,  fig.width=7, fig.height=7, include=TRUE, echo=FALSE}
ggplot(Countries) +
  geom_map(aes(map_id = Paises, fill = fct_rev(count_group)), map = world_map) +
  geom_polygon(data = world_map, aes(x = long, y = lat, group = group), colour = 'black', fill = NA) +
  #expand_limits(x = world_map$long, y = world_map$lat) +
  scale_fill_manual(name = "Collaboration" , values = c("#b2df8a","#1f78b4", "#a6cee3") ) +
  theme_void() +
  coord_fixed() +
  coord_cartesian(xlim = c(-10, 40),ylim = c(15, 65), expand = TRUE)
  


```

 America
 

```{r, fig.width=8, fig.height=8, include=TRUE, echo=FALSE}
ggplot(Countries) +
  geom_map(aes(map_id = Paises, fill = fct_rev(count_group)), map = world_map) +
  geom_polygon(data = world_map, aes(x = long, y = lat, group = group), colour = 'black', fill = NA) +
  #expand_limits(x = world_map$long, y = world_map$lat) +
  scale_fill_manual(name = "Collaboration" , values = c("#b2df8a","#1f78b4", "#a6cee3") ) +
  theme_void() +
  coord_fixed() +
  coord_cartesian(xlim = c(-150, -20),ylim = c(-50, 70), expand = TRUE)
  #coord_sf(xlim = c(-20, 40), ylim = c(15, 70), expand = TRUE) 
  

```

 