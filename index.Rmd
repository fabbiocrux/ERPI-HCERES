---
title: "HCERES ERPI"
description: |
  Production de connaissances et activités concourant au rayonnement et à l’attractivité scientifique.
author:
    
  - first_name: "Mauricio"
    last_name: "Camargo"
    url: https://erpi.univ-lorraine.fr/people/Mauricio-Camargo/
    affiliation: ERPI
    affiliation_url: https://erpi.univ-lorraine.fr/
    orcid_id: 0000-0003-3867-2438 
  - first_name: "Fréderique"
    last_name: "Mayer"
    url: https://erpi.univ-lorraine.fr/people/Frederique-Mayer/
    affiliation: ERPI
    affiliation_url: https://erpi.univ-lorraine.fr/
    orcid_id: 
  - first_name: "Eric"
    last_name: "Bonjour"
    url: https://erpi.univ-lorraine.fr/people/Eric-Bonjour/
    affiliation: ERPI
    affiliation_url: https://erpi.univ-lorraine.fr/
    orcid_id: 0000-0001-7851-1095 
  - first_name: "Manon"
    last_name: "Enjolras"
    url: https://erpi.univ-lorraine.fr/people/Manon-Enjolras/
    affiliation: ERPI
    affiliation_url: https://erpi.univ-lorraine.fr/
    orcid_id: 0000-0003-4570-1989
        
  - first_name: "Fabio"
    last_name: "Cruz"
    url: https://erpi.univ-lorraine.fr/people/Fabio-Cruz/
    affiliation: ERPI
    affiliation_url: https://erpi.univ-lorraine.fr/
    orcid_id: 0000-0001-8529-5327
date: "`r Sys.Date()`"
#output: distill::distill_article
site: distill::distill_website
editor_options: 
  chunk_output_type: console
---

```{r setup, include=FALSE}

knitr::opts_chunk$set(echo = FALSE)
library(tidyverse)
library(knitr)
library(kableExtra)
#library(DT)
library(rmarkdown)
library(reactable)
library(here)
library(jsonlite)
library(tidyverse)
library(plotly)
library(reshape2)


theme_fabio <- function(base_size = 12, base_family = "Palatino"){
  theme_minimal(base_size = base_size, base_family = base_family) %+replace%
    theme(
      #line = element_line(colour="black"),
      #text = element_text(colour="black"),
      #axis.title = element_text(size = 14),
      #axis.text = element_text(colour="black", size=8),
      #strip.text = element_text(size=12),
      #legend.key=element_rect(colour=NA, fill =NA),
      #panel.grid = element_blank(),   
      #panel.border = element_rect(fill = NA, colour = "black", size=1),
      #panel.background = element_rect(fill = "white", colour = "black"), 
      #strip.background = element_rect(fill = NA),
      #plot.title = element_text(family = "Palatino", color="#666666", face="bold", size=20, hjust=0)
      )
}


  

  
  
```


# Critères d'evaluation

```{r table-evaluation, layout="l-body-outset"}

Criteria <- tribble(
  ~Type,  ~Production,
  "Articles scientifiques", "77",
  "Articles de sythèse / revues bibliographiques", "",
  "Autres articles (articles publiés dans des revues professionnelles ou techniques, etc)", " ",
  
  "Monographies, éditions critiques, traductions", " ",
  "Direction et coordination d'ouvrages scientifiques / édition scientifique", " ",
  "Direction et coordination d'ouvrages scientifiques / édition scientifique en anglais ou dans une autre langue étrangère", " ",
  "Chapitres d'ouvrage", " ",
  "Chapitres d'ouvrages en anglais ou dans une autre langue étrangère", " ",
  "Thèse éditées", "16",
  "Editions d'actes de colloques / congrès", "",
  "Articles publiés dans des actes de colloques / congrès", "81",
  "Autres produits présentés dans des colloques / congrès et des séminaires de recherche", "",
  
  "Logiciels", "",
  "Base de données", "",
  "Outils d'aide à la désicion", "",
  "Cohortes", "",
  
  
  "Prototypes et démostrateurs", "",
  "Plateformes et observatoires", "",
  
  "Créations artistiques théorisées, mises en scènes, films", "",
  
  "Participation à des comités éditoriaux (journaux scientifiques, revues, collections, etc)", "",
  "Direction de collection et de séries", "",
  
  "Evaluation d'articles et d'ouvrages scientifiques (relecture d'articles / reviewing)", ""
  
)

```

```{r table-evaluation-1, layout="l-body-outset"}
Criteria %>% 
  kbl( caption = "Indicators for ERPI 2016 - 2020") %>%
  kable_paper("hover", full_width = F) %>% 
  pack_rows("Journaux / revues", 1, 3) %>%
  pack_rows("Ouvrages", 4, 9) %>%
  pack_rows("Production dans des colloques / congrès, séminaires de recherche", 10, 12) %>%
  pack_rows("Produits et outils informatiques", 13, 16) %>%
  pack_rows("Développements instrumentaux et méthodologiques", 17, 18) %>%
  pack_rows("Autres produits propres à une discipline", 19, 19) %>%
  pack_rows("Activités éditoriales", 20, 21) %>%
  pack_rows("Activités d'évaluation", 22, 22)
  
  
```


---

# Workshop ERPI 2019

## Competences ERPI par rapport aux reference ministère

```{r, cache=TRUE}

Competences <- read_csv(here("Workshop", "Explanation.competences.csv"))
reactable(Competences,
          defaultColDef = colDef(
            header = function(value) gsub(".", " ", value, fixed = TRUE),
            #cell = function(value) format(value, nsmall = 1),
            align = "center",
            minWidth = 25,
            headerStyle = list(background = "#f7f7f8")
          ),
          columns = list(
            Competence = colDef(minWidth = 50),   
            Description = colDef(minWidth = 150)
          ),
          wrap = TRUE,
          filterable = TRUE, 
          bordered = TRUE, striped = TRUE, highlight = TRUE,
          compact = TRUE,
          showPageSizeOptions = TRUE, pageSizeOptions = c(1,5, 10, 50,100), defaultPageSize = 3,
          #groupBy = "Year"
)
```

### Levels

+-------------+------------------------------------------+---------------------------------------------------------------------+------------------------------------------------------------------------+----------------------------------------------------------------------------------------+------------------------------------------------------------+------------------------------------------------------------------------------------------------------+
| Level       | 0                                        | 1                                                                   | 2                                                                      | 3                                                                                      | 4                                                          | 5                                                                                                    |
+=============+==========================================+=====================================================================+========================================================================+========================================================================================+============================================================+======================================================================================================+
| Type        |                                          | Novice                                                              | Débutant avancé                                                        | Compétent                                                                              | Performant                                                 | Expert                                                                                               |
+-------------+------------------------------------------+---------------------------------------------------------------------+------------------------------------------------------------------------+----------------------------------------------------------------------------------------+------------------------------------------------------------+------------------------------------------------------------------------------------------------------+
| Explanation | Ne comprend pas quelle est la compétence | Comprendre ce qu'est la compétence et pourquoi elle est importante. | Cette compétence est démontrée sous supervision ou avec encouragement. | Cette compétence est démontrée indépendamment de la supervision ou de l'encouragement. | Encourager ou superviser les autres dans cette compétence. | Développer de nouvelles façons d'appliquer cette compétence. C'est mesuré sur la scène International |
+-------------+------------------------------------------+---------------------------------------------------------------------+------------------------------------------------------------------------+----------------------------------------------------------------------------------------+------------------------------------------------------------+------------------------------------------------------------------------------------------------------+



```{r, layout="l-page", fig.width=10, fig.height=10, cache=TRUE}

source(here("Workshop/Workshop_2019.R"))
Workshop()

```






# Document froms HAL 2016 - 2020

Last update from HAL:  "`r format(Sys.time(), '%d %B, %Y')`"


```{r HAL, include=FALSE}
# Data HAL ----
#HAL <- read_csv("HAL/HAL-May-2021.csv") %>% select(uri_s, title_s, authFullName_s, docType_s, doiId_s, publicationDateY_i, journalTitle_s, journalPublisher_s, conferenceTitle_s, language_s )
HAL <- read_csv("HAL/HAL-June-2021.csv") %>% set_names("Url", "Title", "Authors", "Type.document", "DOI", "Year", "Journal", "Publisher", "Conference", "Labs", "Countries") 
  


  ## Filtering 2016 and tolower
HAL <- HAL %>% filter(Year >= 2016, Year<2021)
HAL$Journal = tolower(HAL$Journal)

#HAL %>% group_by(Type.document) %>% tally()


#write.csv2(HAL, "HAL/HAL-2016-2020.csv")
#write_csv2(HAL, "HAL/HAL-2016-2020.csv")
#write_excel_csv2(HAL, "HAL/HAL-2016-2020-excel.csv")


# Data Scopus ----

Scopus <- read_csv2("Scopus/Scopus-2019.csv") 
names(Scopus)[2]=c("Journal")
#Scopus = Scopus %>%  rename(Journal = Title)
Scopus$Journal = tolower(Scopus$Journal)
Journal_scopus <- factor(Scopus$Journal) %>% unique()

#HAL <- HAL %>% left_join(Scopus, by= "Journal")

names(HAL)
HAL <- 
  HAL %>%
  mutate(
    Scopus = case_when(
      HAL$Journal %in% Journal_scopus ~ "Oui",
      TRUE                      ~ "Non"
    ))
```


```{r Scimago, include=FALSE}
# Scimago ----
## Engineering
Engineering.Scimago <- read.csv2("HAL/Scimago/Engineering.csv") %>%  select(Title, SJR.Best.Quartile, H.index)
Engineering.Scimago <-  Engineering.Scimago %>% set_names("Journal", "Scimago<br/>Engineering", "H.Factor")
Engineering.Scimago$Journal = tolower(Engineering.Scimago$Journal)


## Decision Science
DS.Scimago <- read.csv2("HAL/Scimago/Decision-sciences.csv") %>%  select(Title, SJR.Best.Quartile, H.index)
DS.Scimago <-  DS.Scimago %>% set_names("Journal", "Scimago<br/>Decision<br/>Sciences", "H.Factor")
DS.Scimago$Journal = tolower(DS.Scimago$Journal)



# ERPI PUblications
ERPI <- left_join(HAL, Engineering.Scimago, by="Journal" )
ERPI <- left_join(ERPI, DS.Scimago, by="Journal" )


## H factor
ERPI <-  ERPI %>% mutate(H.Factor = coalesce(H.Factor.x, H.Factor.y))


ERPI <- ERPI %>% select(Year,Type.document , Title, Authors, DOI, Journal, 'Scimago<br/>Engineering', 'Scimago<br/>Decision<br/>Sciences' , Publisher, Conference ,  Url, H.Factor)


ERPI <- ERPI %>%arrange(desc(Year), Type.document)
names(ERPI)

#write_excel_csv2(ERPI, "HAL/ERPI-2016-2020.csv")
```



```{r Hal_raw, layout="l-screen-inset shaded"}

reactable(HAL %>% select(-Publisher) %>% arrange(desc(Year)),
          defaultColDef = colDef(
            header = function(value) gsub(".", " ", value, fixed = TRUE),
            #cell = function(value) format(value, nsmall = 1),
            align = "center",
            minWidth = 25,
            headerStyle = list(background = "#f7f7f8")
          ),
          columns = list(
            Url = colDef(minWidth = 40),   
            Title = colDef(minWidth = 100),   
            Authors = colDef(minWidth = 100),   
            Type.document = colDef(minWidth = 30),   
            DOI = colDef(minWidth = 30),   
            Year = colDef(minWidth = 40),   
            Journal = colDef(minWidth = 30) ,  
            #Publisher = colDef(minWidth = 30),
            Conference = colDef(minWidth = 50),
            Labs = colDef(minWidth = 50),
            Countries = colDef(minWidth = 25)
          ),
          wrap = TRUE,
          filterable = TRUE, 
          bordered = TRUE, striped = TRUE, highlight = TRUE,
          compact = TRUE,
          showPageSizeOptions = TRUE, pageSizeOptions = c(1,5, 10, 50,100), defaultPageSize = 5,
          #groupBy = "Year"
)
```

## Evolution of ERPI's Scientific production


```{r Production_total, layout="l-body-outset", fig.width=8, fig.height=4 }

# Filtering by Article, Conference and THesis
Production <- HAL %>% filter(Type.document == "ART" | Type.document == "COMM" | Type.document == "THESE")

# Counting the total production
total <- Production %>% group_by(Type.document) %>% summarise(total = sum(n()))

# Total of articles
Production %>% group_by(Year, Type.document) %>% tally(name = "Quantity") %>% 
  ggplot(aes(x=Year, y=Quantity, color = Type.document )) +
  geom_line() + geom_point() +
  labs(x="Années", y="Nombre des documents", title = "Production scientifique ERPI", subtitle = "Articles, Conferences  et Thèses doctorat") +
  scale_colour_discrete(name  ="Total par type\nde publication",
                            breaks=c("ART", "COMM", "THESE"),
                            labels=c(paste0("Articles = ", total$total[1]),
                                     paste0("Conferences = ", total$total[2]),
                                     paste0("Phd Thèses = ", total$total[3])
                                     )) +
      # scale_shape_discrete(name  ="Type de document",
      #                       breaks=c("ART", "COMM", "THESE"),
      #                       labels=c("Article", "Conferences", "Phd Thèses"))
  coord_cartesian(ylim = c(0, 30)) +
  theme_fabio()

  
```

## Journals

```{r Journals, layout="l-body-outset", fig.width=8, fig.height=4 }

# Create test data.
Articles <- HAL %>% filter(Type.document == "ART") %>% arrange(desc(Year))

Journals <- Articles  %>% group_by(Journal) %>% summarise(Quantity=n()) %>% mutate(Journal=factor(Journal, Journal))


Journals %>%
   arrange(Quantity) %>%
   filter(Quantity >= 2) %>%
   mutate(Journal=factor(Journal, Journal)) %>%
   ggplot( aes(x=Journal, y=Quantity) ) +
   geom_segment( aes(x=Journal ,xend=Journal, y=0, yend=Quantity), color="grey") +
   geom_point(size=3, color="#69b3a2") +
   coord_flip() +
   theme_fabio() +
   #theme_minimal(base_size = 15, base_family = "Palatino") +
   labs(x = "", y = "Quantité  d'article", title = "Journaux scientifiques principaux",
        subtitle = "Minimum 2 articles dans ces Journaux") +
   #    theme_ipsum() +
   theme(
      panel.grid.minor.y = element_blank(),
      panel.grid.major.y = element_blank(),
      legend.position="none"
   ) +
   xlab("")


# Revistas$Journal
# IF_manuel <- tibble(
#   Journal=c(),
#   Impact_factor_2019 = c() 
#   
# )

```


## Articles à Comité de Lecture

Journaux referencés par Scopus et par annés depuis les publication ERPI


```{r, layout="l-screen-inset", include=TRUE}

# Impact Factor
JCR <- read_csv("JCR/JCR.csv", skip = 1) %>% 
  rename(Journal=`Full Journal Title`,
         Impact_factor_2019= `Journal Impact Factor`) %>% 
  select(Journal, Impact_factor_2019)
JCR$Journal = tolower(JCR$Journal)


Revistas <- 
  HAL %>% filter(Type.document == "ART") %>% arrange(desc(Year)) %>%
    select(Year, Title, Authors, Journal, Scopus)

Revistas <- Revistas %>% left_join(JCR, by= "Journal")

#paged_table(Revistas, options = list(cols.min.print=2))

# library(flextable)
# flextable(Revistas)

# Revistas %>% mutate(N=rownames(Revistas)) %>% select(N,Year:Impact_factor_2019) %>% 
#   kbl( caption = "Articles for ERPI 2016 - 2020") %>%
#   kable_paper("hover", full_width = F)

Revistas <- Revistas %>% mutate(N=rownames(Revistas)) %>% select(N,Year:Impact_factor_2019)

library(reactable)
reactable(Revistas,
          defaultColDef = colDef(
            header = function(value) gsub(".", " ", value, fixed = TRUE),
            #cell = function(value) format(value, nsmall = 1),
            align = "center",
            minWidth = 70,
            headerStyle = list(background = "#f7f7f8")
          ),
          columns = list(
            N = colDef(minWidth = 20),   
            Year = colDef(minWidth = 30, sortable = TRUE),   
            Title = colDef(minWidth = 200),   
            Authors = colDef(minWidth = 100),   
            Journal = colDef(minWidth = 100),   
            Scopus = colDef(minWidth = 40),   
            Impact_factor_2019 = colDef(minWidth = 30)   
          ),
          
          filterable = TRUE, 
          bordered = TRUE, striped = TRUE, highlight = TRUE,
          compact = TRUE,
          showPageSizeOptions = TRUE, pageSizeOptions = c(1,5, 10, 50,100), defaultPageSize = 5,
          #groupBy = "Year"
)
```


```{r Scopus-1}
Articles <- HAL %>% filter(Type.document == "ART") %>% arrange(desc(Year))

Articles %>% group_by(Year, Scopus) %>% tally(name = "Quantity") %>% 
  ggplot(aes(x=Year, y=Quantity, color = Scopus )) +
  geom_line() + geom_point() +
  labs(x="Années", y="Nombre des documents", title = "Articles listés dans la base SCOPUS", subtitle = "") +
  theme_fabio()
```


### Sous-domaines selons Scopus

SCOPUS a une serie de Sous domaine lié à chaque journal. 
Dans ce wordcloud, une presentation des sous-domaines en tulisant les journaux references Scopus publiés par ERPI dans la periode 2016-2020

```{r, layout="l-body-outset", fig.width=8, fig.height=4}
library(wordcloud2)
Domaines <- 
  HAL %>% 
  filter(Type.document == "ART") %>% 
  filter(Scopus == "Oui") %>% 
  left_join(Scopus, by= "Journal") %>% 
  select("Scopus Sub-Subject Area") %>% 
  group_by(`Scopus Sub-Subject Area`) %>% 
  tally(sort = TRUE, name = "Frequency") 

wordcloud2(data = Domaines,  shape = 'circle', size=0.2 ) 

```

### Analyse CiteScore 

Scopus utilise cette mésure au lieu d'Impact factor utilisé par Thomson-Reuters

```{r Citescore}

# Obtaining the CIteScore  
Citescore <-  Scopus %>% select(Journal, CiteScore) %>% unique()

Articles <- 
  HAL %>% 
  filter(Type.document == "ART") %>% 
  filter(Scopus == "Oui") %>% 
  left_join(Citescore, by= "Journal")  
  
Articles$Year <- as.factor(Articles$Year)

Articles %>% 
  ggplot( aes(x=Year, y=CiteScore)) +
    geom_boxplot(fill="slateblue", alpha=0.5) +
  labs(x="Années", y="CiteScore", title = "Profile CiteScore de l'ERPI", subtitle = "") +
  theme_fabio()
```


## Quartiles of the Publications

```{r}

Qs <- 
  HAL %>% 
  filter(Type.document == "ART") %>% 
  filter(Scopus == "Oui") %>% 
  left_join(Scopus, by= "Journal") %>% 
  select("Scopus Sub-Subject Area") %>% 
  group_by(`Scopus Sub-Subject Area`) %>% 
  tally(sort = TRUE, name = "Frequency") 
  


```



## Analyse JCR (Impact Factor)

```{r}

  
  


```


<!-- ### Scimago Engineering -->

```{r, layout="l-body-outset", fig.width=8, fig.height=4, include=FALSE, eval=FALSE}

Articles %>% group_by(Year, `Scimago<br/>Engineering`) %>% tally(name = "Quantity") %>% 
  ggplot(aes(x=Year, y=Quantity, color = `Scimago<br/>Engineering` )) +
  geom_line() + geom_point() +
  labs(x="Années", y="Nombre des documents \n QuArtiles", title = "Production scientifique ERPI", subtitle = "Articles") +
  scale_colour_discrete(name  = "Scimago (Engineering)" ) +

                            #breaks=c("Q1", "Q2", "NA"),
                            #labels=c("Q1", "Q2", "à Identifier")) +
      # scale_shape_discrete(name  ="Type de document",
      #                       breaks=c("ART", "COMM", "THESE"),
      #                       labels=c("Article", "Conferences", "Phd Thèses"))
  theme_fabio() +
  coord_cartesian(ylim = c(0, 25))
  
```

<!-- ### Scimago Desicion Sciences -->

```{r, layout="l-body-outset", fig.width=8, fig.height=4, include=FALSE, eval=FALSE }


Publications %>% group_by(Year, `Scimago<br/>Decision<br/>Sciences`) %>% tally(name = "Quantity") %>% 
  ggplot(aes(x=Year, y=Quantity, color = `Scimago<br/>Decision<br/>Sciences` )) +
  geom_line() + geom_point() +
  labs(x="Années", y="Nombre des documents \n QuArtiles", title = "Production scientifique ERPI", subtitle = "Articles") +
  scale_colour_discrete(name  = "Scimago (Desicion Sciences)" ) +

                            #breaks=c("Q1", "Q2", "NA"),
                            #labels=c("Q1", "Q2", "à Identifier")) +
      # scale_shape_discrete(name  ="Type de document",
      #                       breaks=c("ART", "COMM", "THESE"),
      #                       labels=c("Article", "Conferences", "Phd Thèses"))
  theme_minimal() +
  theme(axis.text=element_text(size=14, family = "Palatino"),
        axis.title=element_text(size=16,face="bold", family = "Palatino"),legend.position="right")+
  theme(plot.title = element_text(family = "Palatino", color="#666666", face="bold", size=20, hjust=0)) +
  coord_cartesian(ylim = c(0, 25))
  
```



## Tranches d'Ages



```{r, include=FALSE}
library("readxl")
library(lubridate)

onglet <- excel_sheets("Mauricio/Annexe-5.xlsx")
Edades <- read_excel("Mauricio/Annexe-5.xlsx",
                     sheet = onglet[4], skip = 32,
                     col_names = c("Nom", "Prénom", "Sexe", "Corps-grade", "Type_emploi",
                                   "Axe", "Date_naissance", "BAP", "HDR", "Employeur",
                                   "Code_UAI", "Date_in", "Date_out"), 
                     col_types = c( rep("text",6), "date", 
                                    rep("text",4), "date", "date" 
                                    ))
# Filtering the data
Edades <- Edades[1:44,]
Edades$today <- Sys.time()

Edades$ages = interval(start = Edades$Date_naissance, end = Edades$today) /
        duration(num = 1, units = "years") %>% round(., digits = 0)

Edades$rango <- ordered( cut(Edades$ages, breaks = c(seq(20,70,10)), 
                           include.lowest = TRUE))
# Deleting personnes 
Excluidos <- Edades %>%
  filter(Prénom %in% c('NOÉMIE', 'CEDRIC', 'GREGORY', "ALEXIS", "STÉPHANE", "PEDRO", "CHRISTIAN", "DANIEL ANDRES", "MARIE REINE", "PATRICK")) 

Membres <- Edades %>% anti_join(Excluidos)



```

Membres (Prof, MDF, Admin et PostDoc/Chercheur contractuelle) présents à 2020 à l'ERPI:
**Quantité total des perssones** : `r nrow(Membres)`


Voila la liste des perssones à Dec 2020.

```{r}
paged_table(Membres %>% select( Prénom, Nom)) %>% arrange(Prénom)
```

Un résume par Status

```{r}
paged_table(Membres %>% group_by(`Corps-grade`) %>% tally() %>% set_names("Status", "Quantité"))
```

Pyramide des ages

```{r, layout="l-body-outset", fig.width=6, fig.height=4, include=TRUE}
library(lemon)
piramide <- Membres %>% group_by(rango, Sexe) %>% tally()
ggplot(data = piramide, 
       mapping = aes(x = ifelse(test = Sexe == "H", yes = -n, no = n), 
                     y = rango, fill = Sexe)) +
  geom_col() +
  scale_x_symmetric(labels = abs, n.breaks=10) +
  #scale_x_continuous(breaks = c(-6,-4,-2,0, 2, 4, 6)) +
  
  labs(x="Nombre des personnes", y="Intervalle", subtitle = "Tranche d'ages à l'ERPI", title = "") +
  theme_fabio() +
  scale_fill_brewer(palette = "Set2") 

```


Pyramide des ages sans les chercheur contractuelles / Postdocs

```{r, layout="l-body-outset", fig.width=6, fig.height=4, include=TRUE}

piramide <- Membres %>% filter(Type_emploi != "Ch_aut") %>% group_by(rango, Sexe) %>% tally()

ggplot(data = piramide, 
       mapping = aes(x = ifelse(test = Sexe == "H", yes = -n, no = n), 
                     y = rango, fill = Sexe)) +
  geom_col() +
  scale_x_symmetric(labels = abs, n.breaks=10) +
  #scale_x_continuous(breaks = c(-6,-4,-2,0, 2, 4, 6)) +
  
  labs(x="Nombre des personnes", y="Intervalle", subtitle = "Tranche d'ages à l'ERPI\n(Sans chercheurs contractuelles)", title = "") +
  theme_fabio() +
  scale_fill_brewer(palette = "Set2") 

```


# International Collaborations {#collaboration}

```{r, include=FALSE, echo=FALSE}
library(rworldmap)
library(maps)
library(RColorBrewer)
library(forcats)


Countries <- paste(HAL$Countries,collapse=",")  
Countries <- strsplit(Countries, ",")  
Countries <- tibble(Paises=Countries[[1]])
Countries$Paises <- Countries$Paises %>% toupper() 
Countries <- Countries %>% group_by(Paises) %>% tally(name = "freq")

Countries$count_group <- cut(Countries$freq, 
                       breaks = c(-Inf, 2, 4, Inf), 
                       labels = c("Exploratoire\n(<2)", "En construction\n(2-4)", "Recurrent\n(>4)" ))

world_map <- map_data(map = "world")
world_map$region <- iso.alpha(world_map$region)
str(world_map)


```


```{r, layout="l-body-outset", fig.width=8, fig.height=4, include=TRUE, echo=FALSE}
ggplot(Countries) +
  geom_map(aes(map_id = Paises, fill = fct_rev(count_group)), map = world_map) +
  geom_polygon(data = world_map, aes(x = long, y = lat, group = group), colour = 'black', fill = NA) +
  #expand_limits(x = world_map$long, y = world_map$lat) +
  scale_fill_manual(name = "Collaboration" , values = c("#b2df8a","#1f78b4", "#a6cee3") ) +
  theme_void() +
  coord_fixed() 


```

On Europe

```{r,  fig.width=7, fig.height=7, include=TRUE, echo=FALSE}
ggplot(Countries) +
  geom_map(aes(map_id = Paises, fill = fct_rev(count_group)), map = world_map) +
  geom_polygon(data = world_map, aes(x = long, y = lat, group = group), colour = 'black', fill = NA) +
  #expand_limits(x = world_map$long, y = world_map$lat) +
  scale_fill_manual(name = "Collaboration" , values = c("#b2df8a","#1f78b4", "#a6cee3") ) +
  theme_void() +
  coord_fixed() +
  coord_cartesian(xlim = c(-10, 40),ylim = c(15, 65), expand = TRUE)
  


```

 America
 

```{r, fig.width=8, fig.height=8, include=TRUE, echo=FALSE}
ggplot(Countries) +
  geom_map(aes(map_id = Paises, fill = fct_rev(count_group)), map = world_map) +
  geom_polygon(data = world_map, aes(x = long, y = lat, group = group), colour = 'black', fill = NA) +
  #expand_limits(x = world_map$long, y = world_map$lat) +
  scale_fill_manual(name = "Collaboration" , values = c("#b2df8a","#1f78b4", "#a6cee3") ) +
  theme_void() +
  coord_fixed() +
  coord_cartesian(xlim = c(-150, -20),ylim = c(-50, 70), expand = TRUE)
  #coord_sf(xlim = c(-20, 40), ylim = c(15, 70), expand = TRUE) 
  

```

 